<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>SWC-107 · Overview</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="# Title "/><meta name="docsearch:language" content="en"/><meta property="og:title" content="SWC-107 · Overview"/><meta property="og:type" content="website"/><meta property="og:url" content="https://SmartContractSecurity.github.io/SWC-registry/index.html"/><meta property="og:description" content="# Title "/><meta property="og:image" content="https://SmartContractSecurity.github.io/SWC-registry/img/docusaurus.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://SmartContractSecurity.github.io/SWC-registry/img/docusaurus.png"/><link rel="shortcut icon" href="/SWC-registry/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="stylesheet" href="/SWC-registry/css/main.css"/></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/SWC-registry/"><h2 class="headerTitle">Overview</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/SWC-registry/docs/SWC-100" target="_self">Registry</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>SWC ID</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">SWC ID</h3><ul><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-100">SWC-100</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-101">SWC-101</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-102">SWC-102</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-103">SWC-103</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-104">SWC-104</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-105">SWC-105</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-106">SWC-106</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/SWC-registry/docs/SWC-107">SWC-107</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-108">SWC-108</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-109">SWC-109</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-110">SWC-110</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-111">SWC-111</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-112">SWC-112</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-113">SWC-113</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-114">SWC-114</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-115">SWC-115</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-116">SWC-116</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-117">SWC-117</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-118">SWC-118</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-119">SWC-119</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-120">SWC-120</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-121">SWC-121</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-122">SWC-122</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-123">SWC-123</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-124">SWC-124</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-125">SWC-125</a></li><li class="navListItem"><a class="navItem" href="/SWC-registry/docs/SWC-127">SWC-127</a></li></ul></div></div></section></div><script>
            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docMainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">SWC-107</h1></header><article><div><span><h1><a class="anchor" aria-hidden="true" id="title"></a><a href="#title" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Title</h1>
<p>Reentrancy</p>
<h2><a class="anchor" aria-hidden="true" id="relationships"></a><a href="#relationships" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Relationships</h2>
<p><a href="https://cwe.mitre.org/data/definitions/841.html">CWE-841: Improper Enforcement of Behavioral Workflow</a></p>
<h2><a class="anchor" aria-hidden="true" id="description"></a><a href="#description" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Description</h2>
<p>One of the major dangers of calling external contracts is that they can take over the control flow. In the reentrancy attack (a.k.a. recursive call attack), a malicious contract calls back into the calling contract before the first invocation of the function is finished. This may cause the different invocations of the function to interact in undesirable ways.</p>
<h2><a class="anchor" aria-hidden="true" id="remediation"></a><a href="#remediation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Remediation</h2>
<p>The best practices to avoid Reentrancy weaknesses are:</p>
<ul>
<li>Use <code>transfer()</code> instead of <code>contract.call()</code> to transfer Ether to untrusted addresses.</li>
<li>When using low-level calls, make sure all internal state changes are performed before the call is executed.</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="references"></a><a href="#references" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>References</h2>
<ul>
<li><a href="https://consensys.github.io/smart-contract-best-practices/known_attacks/#reentrancy">Ethereum Smart Contract Best Practices - Reentrancy</a></li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="contract-samples"></a><a href="#contract-samples" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Contract Samples</h2>
<h3><a class="anchor" aria-hidden="true" id="simple-daosol"></a><a href="#simple-daosol" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>simple_dao.sol</h3>
<pre><code class="hljs css language-Solidity"><span class="hljs-comment">/*
 * <span class="hljs-doctag">@source</span>: http://blockchain.unica.it/projects/ethereum-survey/attacks.html#simpledao
 * <span class="hljs-doctag">@author</span>: Atzei N., Bartoletti M., Cimoli T
 * Modified by Josselin Feist
 */</span>
pragma solidity <span class="hljs-number">0.4</span><span class="hljs-number">.24</span>;

contract SimpleDAO {
  mapping (address =&gt; <span class="hljs-keyword">uint</span>) <span class="hljs-keyword">public</span> credit;
    
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">donate</span><span class="hljs-params">(address to)</span> <span class="hljs-title">payable</span> <span class="hljs-title">public</span></span>{
    credit[to] += msg.value;
  }
    
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">withdraw</span><span class="hljs-params">(uint amount)</span> <span class="hljs-title">public</span></span>{
    <span class="hljs-keyword">if</span> (credit[msg.sender]&gt;= amount) {
      <span class="hljs-keyword">require</span>(msg.sender.call.value(amount)());
      credit[msg.sender]-=amount;
    }
  }  

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">queryCredit</span><span class="hljs-params">(address to)</span> <span class="hljs-title">view</span> <span class="hljs-title">public</span> <span class="hljs-title">returns</span><span class="hljs-params">(uint)</span></span>{
    <span class="hljs-keyword">return</span> credit[to];
  }
}

</code></pre>
<h4><a class="anchor" aria-hidden="true" id="simple-daoyaml"></a><a href="#simple-daoyaml" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>simple_dao.yaml</h4>
<pre><code class="hljs css language-yaml"><span class="hljs-attr">description:</span> <span class="hljs-string">"Reentrancy (state change after external call)"</span>
<span class="hljs-attr">issues:</span>
<span class="hljs-attr">- id:</span> <span class="hljs-string">"SWC-107"</span>
<span class="hljs-attr">  count:</span> <span class="hljs-number">1</span>
<span class="hljs-attr">  locations:</span>
<span class="hljs-attr">  - bytecode_offsets:</span> <span class="hljs-string">[565,</span> <span class="hljs-number">655</span><span class="hljs-string">]</span>
<span class="hljs-attr">    line_numbers:</span> <span class="hljs-string">[17,18]</span>

</code></pre>
<h3><a class="anchor" aria-hidden="true" id="simple-dao-fixedsol"></a><a href="#simple-dao-fixedsol" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>simple_dao_fixed.sol</h3>
<pre><code class="hljs css language-Solidity"><span class="hljs-comment">/*
 * <span class="hljs-doctag">@source</span>: http://blockchain.unica.it/projects/ethereum-survey/attacks.html#simpledao
 * <span class="hljs-doctag">@author</span>: Atzei N., Bartoletti M., Cimoli T
 * Modified by Bernhard Mueller, Josselin Feist
 */</span>
pragma solidity <span class="hljs-number">0.4</span><span class="hljs-number">.24</span>;

contract SimpleDAO {
  mapping (address =&gt; <span class="hljs-keyword">uint</span>) <span class="hljs-keyword">public</span> credit;
    
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">donate</span><span class="hljs-params">(address to)</span> <span class="hljs-title">payable</span> <span class="hljs-title">public</span></span>{
    credit[to] += msg.value;
  }
    
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">withdraw</span><span class="hljs-params">(uint amount)</span> <span class="hljs-title">public</span> </span>{
    <span class="hljs-keyword">if</span> (credit[msg.sender]&gt;= amount) {
      credit[msg.sender]-=amount;
      <span class="hljs-keyword">require</span>(msg.sender.call.value(amount)());
    }
  }  

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">queryCredit</span><span class="hljs-params">(address to)</span> <span class="hljs-title">view</span> <span class="hljs-title">public</span> <span class="hljs-title">returns</span> <span class="hljs-params">(uint)</span></span>{
    <span class="hljs-keyword">return</span> credit[to];
  }
}

</code></pre>
<h4><a class="anchor" aria-hidden="true" id="simple-dao-fixedyaml"></a><a href="#simple-dao-fixedyaml" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>simple_dao_fixed.yaml</h4>
<pre><code class="hljs css language-yaml"><span class="hljs-attr">description:</span> <span class="hljs-string">"Reentrancy (state change after external call)"</span>
<span class="hljs-attr">issues:</span>
<span class="hljs-attr">- id:</span> <span class="hljs-string">"SWC-107"</span>
<span class="hljs-attr">  count:</span> <span class="hljs-number">0</span>

</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/SWC-registry/docs/SWC-106"><span class="arrow-prev">← </span><span>Previous</span></a><a class="docs-next button" href="/SWC-registry/docs/SWC-108"><span>Next</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav docOnPageNav"><ul class="toc-headings"><li><a href="#relationships">Relationships</a></li><li><a href="#description">Description</a></li><li><a href="#remediation">Remediation</a></li><li><a href="#references">References</a></li><li><a href="#contract-samples">Contract Samples</a><ul class="toc-headings"><li><a href="#simple-daosol">simple_dao.sol</a></li><li><a href="#simple-dao-fixedsol">simple_dao_fixed.sol</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><div><h5>Docs</h5><a href="https://smartcontractsecurity.github.io/SWC-registry/#create-a-new-swc-entry">How to add a SWC definition</a><a href="https://smartcontractsecurity.github.io/SWC-registry/#create-a-test-case">How to add a test case</a><a href="">EIP XXXX</a></div><div><h5>Community</h5><a href="https://discord.gg/qcNvR2r">Join the Discord channel #swc-registry</a><a href="">Discussion at the Ethereum Magicians</a></div><div><h5>More</h5><a href="https://github.com/SmartContractSecurity/SWC-registry/">Back to SWC-registry repo</a></div></section><section class="copyright">Copyright © 2018 SmartContractSecurity</section><script type="text/javascript" src="https://rawgit.com/s0b0lev/SWC-registry/website/website/scripts/lineNumbers.js"></script></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
              var search = docsearch({
                
                apiKey: '25626fae796133dc1e734c6bcaaeac3c',
                indexName: 'docsearch',
                inputSelector: '#search_input_react'
              });
            </script></body></html>